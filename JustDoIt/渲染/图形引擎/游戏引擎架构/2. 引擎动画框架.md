# 2.1 动画基础原理

## 2.1.1 骨骼原理

骨骼动画（skeletal animation）是一种计算机图形学中的动画技术，主要应用于三维角色动画。其基本原理是**通过使用骨骼结构来控制和驱动一个三维模型的顶点变形**，从而实现角色的动画效果。骨骼动画具有较低的计算复杂度和较高的表现力，因此在游戏、影视等领域得到了广泛应用。

骨骼动画的建立和渲染主要包括4个步骤，建立骨骼结构、绑定模型和骨骼、创建动画、蒙皮计算：
1)  建立骨骼结构：首先，为三维角色模型创建一个骨骼结构，这个结构由多个骨骼节点（或关节）组成，骨骼动画中的骨骼可以简单的理解为树形节点，它们通过父子关系连接在一起。骨骼结构通常与角色的实际解剖结构相对应，如头部、躯干、四肢等。
2) 绑定模型和骨骼：将三维模型的顶点与骨骼结构关联起来，这个过程称为绑定（binding）或蒙皮（skinning）。通常，每个顶点会被分配一个或多个骨骼节点，并赋予相应的权重，以表示该顶点受这些骨骼节点的影响程度。
3)  创建动画：在骨骼结构上定义关键帧动画，包括骨骼节点的位置、旋转和缩放等变换信息。通过在时间轴上设置关键帧，可以实现骨骼结构的动态变化。
4) 蒙皮计算：在实时渲染过程中，根据骨骼结构的当前动画状态，计算每个顶点的最终变换矩阵。这个变换矩阵通常是由顶点关联的骨骼节点的变换矩阵和权重相乘并加权求和得到的。然后，将这个变换矩阵应用于顶点，实现模型的蒙皮变化计算。

### 2.1.2 蒙皮计算原理

动画蒙皮（Skinning）是计算机图形学中的一种技术，用于将骨骼动画应用到三维角色模型上。蒙皮的基本原理是将模型的顶点与骨骼结构关联起来，然后通过驱动骨骼结构的变换来实现模型的顶点变形，从而实现角色的动画效果。蒙皮的计算有3步，骨骼与顶点绑定、计算骨骼节点变换、计算顶点变换矩阵、应用顶点变换：
1) 骨骼和顶点绑定：在蒙皮过程中需要将模型的顶点与骨骼结构中的一个或多个骨骼节点关联起来。通常这个关联关系由一个权重矩阵表示，每个元素表示一个顶点受对应骨骼节点影响的程度。这些权重值通常是归一化的，即一个顶点关联的所有骨骼节点的权重之和为1。
2) 计算骨骼节点变换：在动画过程中每个骨骼节点都会根据关键帧动画数据进行位置、旋转和缩放等的插值计算。这些数据的变化可以通过变换矩阵表示，用于计算顶点的最终变换矩阵。 
3) 计算顶点变换矩阵：对于每个顶点根据其关联的骨骼节点的变换矩阵和权重值，计算该顶点的最终变换矩阵。这个变换矩阵是由关联骨骼节点的变换矩阵与权重值相乘并加权求和得到的。 

       ● 应用顶点变换：将计算出的顶点变换矩阵应用于模型的顶点，实现模型的顶点变化。同时，还需要对顶点的法线和切线等属性进行相应的变换，以确保动画过程中的光照和纹理效果正确。

       每帧骨骼节点的变化都将引起蒙皮的变化，计算骨骼变化矩阵就是为了能计算出蒙皮，最终展示在屏幕上的就是蒙皮的画面。蒙皮计算由蒙皮顶点数据支撑，、引擎每帧都会重新计算蒙皮，其顶点的计算结果由当帧的骨骼最终转换矩阵和顶点相乘计算得来。蒙皮顶点的计算过程如图3.6 所示。


